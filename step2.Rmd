---
title: "Step 2: Observed Data"
output: html_document
---

Objective: document exactly what we will observe (simulated or real) and how those measurements map to the causal model specified in Step 1b.


## Observed‑data structure and statistical model
Each patient contributes the following variables:

| Symbol         | Meaning (HCV→AKI example)                                                                         |
| -------------- | ------------------------------------------------------------------------------------------------- |
| **\$W\$**      | Baseline covariates: age, sex, CKD, diabetes, baseline eGFR, cirrhosis, healthcare utilisation, … |
| **\$A\$**      | Initial antiviral regimen (1 = sofosbuvir‑containing, 0 = non‑sofosbuvir)                         |
| **\$T\$**      | Follow‑up time (days) until first AKI or right‑censoring                                          |
| **\$\Delta\$** | Event type: 1 = AKI, 0 = censoring                                                                |

For the **primary dataset** we treat regimen switching, death, and disenrolment
as censoring (because our estimand imagines switching away).  For the **ITT
sensitivity dataset** we treat only administrative loss as censoring (switch
ignored).

The individual record is

$$
O = (W, A, T, \Delta),
$$

and the statistical model is the non‑parametric class
$\mathcal{M} = \{P(O)\}.$

### 2.1  Data sources & provenance  
- **Simulation dataset** generated by `generate_hcv_data()` in *DGP.R* 
- **Real-world claims-EHR cohort**: HealthVerity standing HCV cohort (2016-2023) as described in the rapid-response report §Methods. 
- Table comparing variable availability, granularity, follow-up calendar for each source.

### 2.2  Definition of time zero  
- Index = first qualifying DAA dispense (SOF or non-SOF).  
- Simulation: `cohort$index_date` implicitly set to day 0; claims-EHR: dispense date with ≥365d clean baseline.

### 2.3  Measurement of exposure  
- Binary **A** = SOF-containing regimen versus comparator.  
- Sim: column `treatment`; probability model uses non-linear LP (see code block 4).  
- Real data: NDC / GPI codes (Appendix 1 of report).

### 2.4  Outcome ascertainment  
| Aspect | Simulation | Real-world |
|--------|------------|------------|
| AKI definition | Event time drawn from exponential or piece-wise hazard (code block 6) | ≥1 ICD-10 code in list N17.*, N19, … (report Table 1) |
| Onset date resolution | exact (days) | date of first claim; potential misclassification |

### 2.5  Covariates / eligibility variables  
- Baseline demographics, comorbidities, meds.  
- Simulation: generated in blocks 1–2 (`age`, `ckd`, `cirrhosis`, 30+ indicators).  
- Real-world: see Propensity Score variable list (§Methods, report). Map each to ICD/Procedure/Drug codes; include a codebook appendix.

### 2.6  Follow-up & censoring indicators  
- Administrative end (`max_follow`, 180 d).  
- Switch censoring (`censor_switch`) vs treatment-policy approach.  
- Death only in RWD (if available).

### 2.7  Data quality & completeness checks  
- Missingness patterns: simulation optional NA introduction (`add_missing`).  
- For claims-EHR: enrollment continuity, lab availability (creatinine) for planned lab-based AKI sensitivity analysis.  
- Summary table: % missing per variable, comparison before/after imputation.

### 2.8  Harmonised analysis dataset specification  
- Common variable names (`A`, `Y`, `Δ`, `W`) across both sources.  
- Derived variables: baseline eGFR category (if labs), Calendar-year strata.  
- Save as feather/CSV; include  MD5 checksum for reproducibility.

### 2.9  Sample size & event counts  
- Simulation default: N = 125 000 → ~2 900 AKI events (h0 × follow-time).  
- Real-world counts: flow diagram from report Table 1 (CONSORT-style).

### 2.10  Fit-for-use assessment  
- Evaluate whether measured **W** block plausible to satisfy exchangeability; highlight key unmeasured factors (e.g., baseline eGFR in claims).  
- Conclude on adequacy or propose data linkage/enrichment if gaps threaten identifiability (feeds into Step 3).
